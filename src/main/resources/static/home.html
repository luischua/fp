<!doctype html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<head>
    <!-- Add Bootstrap and Bootstrap-Vue CSS to the <head> section -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"/>
</head>
<body>
    <div id="app">
        <!-- Info modal -->
        <b-modal :id="infoModal.id" :title="infoModal.title" ok-only @hide="resetInfoModal">
            <pre>{{ infoModal.content }}</pre>
        </b-modal>
        <datalist id="customerSelect">
            <option v-for="[key, value] in customerDataList">{{key}}</option>
        </datalist>
        <datalist id="productSelect">
            <option v-for="[key, value] in productDataList">{{key}}</option>
        </datalist>
        <datalist id="agentSelect">
            <option v-for="[key, value] in agentDataList">{{key}}</option>
        </datalist>
        <datalist id="truckingSelect">
            <option v-for="[key, value] in truckingDataList">{{key}}</option>
        </datalist>
        <datalist id="categorySelect">
            <option v-for="[key, value] in categoryDataList">{{key}}</option>
        </datalist>

        <b-alert :show="dismissCountDown" dismissible fade variant="success" @dismiss-count-down="countDownChanged">
            Save Successful. Alert will dismiss after {{ dismissCountDown }} seconds...
        </b-alert>
            <b-tabs pills card vertical>
                <b-tab title="Order" active>
                    <b-button @click="newFormGeneric(orderForm, defaultOrderValues, 'bv-modal-order')">New</b-button>
                    <b-button @click="refresh('orderTable')">Refresh Table</b-button>
                    <b-form-input v-model="searchForm['Order'].customer" list="customerSelect"></b-form-input>
                    <b-button @click="filterCustomerOrder">Filter by Customer</b-button>
                    <b-form-input v-model="searchForm['Order'].receiptNo"></b-form-input>
                    <b-button @click="filterReceiptNo">Filter by ReceiptNo</b-button>
                    <b-button @click="showPendingOrder">Show Pending Deliveries</b-button>
                    <b-button @click="showDueOrder">Show Due Orders</b-button>
                    <b-button @click="showLastEditedOrder">Last Edited</b-button>
                    Filter by : {{searchForm['Order'].viewId}}
                    <b-modal ref="bv-modal-order" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, orderForm, 'bv-modal-order', 'orderTable')">
                            <b-form-group label="Customer:">
                                <b-form-input v-model="orderForm.customerName" list="customerSelect"></b-form-input>
                            </b-form-group>
                            <b-form-group label="Delivered Date:">
                                <b-calendar v-model="orderForm.deliveredDate" locale="en-US"></b-calendar>
                            </b-form-group>
                            <b-form-group label="Canceled Date:">
                                <b-calendar v-model="orderForm.canceledDate" locale="en-US"></b-calendar>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="orderTable" bordered striped hover sticky-header="600px" :items="orderList" :fields="orderFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, orderForm, 'bv-modal-order')" class="mr-1">
                                Edit
                            </b-button>
                            <b-button size="sm" @click="row.toggleDetails">
                                {{ row.detailsShowing ? 'Hide' : 'Show' }} Order Details
                            </b-button>
                            <br/>
                            <b-button size="sm" @click="info(row.item, row.index, $event.target)" class="mr-1">
                                Info modal
                            </b-button>
                            <b-button size="sm" @click="download(row.item.id)" class="mr-1">
                                Download XLS
                            </b-button>
                            <br/>
                            Last Edited: {{row.item.lastEditedString}}
                        </template>
                        <template #cell(receiptNo)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(customerName)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(deliveredDate)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(total)="data">
                            {{ data.value }}
                        </template>
                        <template #row-details="row">
                            <b-card>
                                <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                                <b-alert variant="danger" :show="showErrorDetail">
                                    <div>System Error</div>
                                    <b-button :pressed.sync="showStackTrace" variant="primary">
                                        {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                                    </b-button>
                                    <b-card v-if="showStackTrace">
                                        {{ errorDetailMessage }}
                                    </b-card>
                                </b-alert>
                                <b-form @submit="onReletedSubmit($event, orderDetailForm, row.item)">
                                    <b-form-group label="Product:">
                                        <b-form-input v-model="orderDetailForm.productName" list="productSelect"></b-form-input>
                                    </b-form-group>
                                    <b-form-group label="Quantity:">
                                        <b-form-input v-model="orderDetailForm.quantity"/>
                                    </b-form-group>
                                    <b-form-checkbox
                                            id="checkbox-1"
                                            v-model="orderDetailForm.isPromo"
                                            name="checkbox-1"
                                            value="true"
                                            unchecked-value="false"
                                    >Promo</b-form-checkbox>
                                    <b-button type="submit" variant="primary">Add</b-button>
                                </b-form>
                                <h4>Product</h4>
                                <b-table  ref="orderDetailProductTable" bordered striped hover sticky-header="600px" :items="row.item.products" :fields="orderDetailProductFields"
                                          :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                                    <template #table-busy>
                                        <div class="text-center text-danger my-2">
                                            <b-spinner class="align-middle"></b-spinner>
                                            <strong>Loading...</strong>
                                        </div>
                                    </template>
                                    <template #cell(quantity)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(name)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(price)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(defaultDiscount)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(total)="data">
                                        {{ data.value }}
                                    </template>
                                </b-table>
                                <h4>Promo</h4>
                                <b-table  ref="orderDetailPromoTable" bordered striped hover sticky-header="600px" :items="row.item.promo" :fields="orderDetailPromoFields"
                                          :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                                    <template #table-busy>
                                        <div class="text-center text-danger my-2">
                                            <b-spinner class="align-middle"></b-spinner>
                                            <strong>Loading...</strong>
                                        </div>
                                    </template>
                                    <template #cell(quantity)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(name)="data">
                                        {{ data.value }}
                                    </template>
                                </b-table>
                                <h4>Payments</h4>
                                <b-table  ref="orderDetailPaymentTable" bordered striped hover sticky-header="600px" :items="row.item.allPayments" :fields="orderDetailPaymentFields"
                                          :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                                    <template #table-busy>
                                        <div class="text-center text-danger my-2">
                                            <b-spinner class="align-middle"></b-spinner>
                                            <strong>Loading...</strong>
                                        </div>
                                    </template>
                                    <template #cell(paymentNo)="data">
                                        {{ data.value }}
                                    </template>
                                    <template #cell(value)="data">
                                        {{ data.value }}
                                    </template>
                                </b-table>
                            </b-card>
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Payment">
                    <b-button @click="newFormGeneric(paymentForm, defaultPaymentValues, 'bv-modal-payment')">New</b-button>
                    <b-button @click="refresh('paymentTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-payment" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, paymentForm, 'bv-modal-payment', 'paymentTable')">
                            <b-form-group label="Type:">
                                <b-form-radio-group
                                        v-model="paymentForm.type"
                                >
                                    <b-form-radio value="check">Check</b-form-radio>
                                    <b-form-radio value="online">Online</b-form-radio>
                                    <b-form-radio value="cash">Cash</b-form-radio>
                                </b-form-radio-group>
                            </b-form-group>
                            <b-form-group label="Receipt Number:">
                                <b-form-input v-model="paymentForm.receiptNoList"/>
                            </b-form-group>
                            <b-form-group label="Value:">
                                <b-form-input v-model="paymentForm.value"/>
                            </b-form-group>
                            <b-form-group label="Bank:">
                                <b-form-input v-model="paymentForm.bank"/>
                            </b-form-group>
                            <b-form-group label="Check No:">
                                <b-form-input v-model="paymentForm.checkNo"/>
                            </b-form-group>
                            <b-form-group label="Clearing Date:">
                                <b-calendar v-model="paymentForm.clearingDate" locale="en-US"></b-calendar>
                            </b-form-group>
                            <b-form-group label="Bounced Date:">
                                <b-calendar v-model="paymentForm.bouncedDate" locale="en-US"></b-calendar>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="paymentTable" bordered striped hover sticky-header="600px" :items="paymentList" :fields="paymentFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, paymentForm, 'bv-modal-payment')" class="mr-1">
                                Edit
                            </b-button>
                            <b-button size="sm" @click="info(row.item, row.index, $event.target)" class="mr-1">
                                Info modal
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Customer">
                    <b-button @click="newFormGeneric(customerForm, defaultCustomerValues, 'bv-modal-customer')">New</b-button>
                    <b-button @click="refresh('customerTable')">Refresh Table</b-button>
                    <b-form-input v-model="searchForm['Customer'].customer" list="customerSelect"></b-form-input>
                    <b-button @click="filterCustomerName">Filter by Name</b-button>
                    <b-button @click="showUncollected">Show Top Uncollected Amount</b-button>
                    <b-button @click="showPaying">Show Top Paying Customers</b-button>
                    Filter by : {{searchForm['Customer'].viewId}}
                   <b-modal ref="bv-modal-customer" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, customerForm, 'bv-modal-customer', 'customerTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="customerForm.name"/>
                            </b-form-group>
                            <b-form-group label="Address:">
                                <b-form-input v-model="customerForm.address"/>
                            </b-form-group>
                            <b-form-group label="Contact:">
                                <b-form-input v-model="customerForm.contact"/>
                            </b-form-group>
                            <b-form-group label="Tel:">
                                <b-form-input v-model="customerForm.telephone"/>
                            </b-form-group>
                            <b-form-group label="Terms:">
                                <b-form-input v-model="customerForm.terms"/>
                            </b-form-group>
                            <b-form-group label="Agent:">
                                <b-form-input v-model="customerForm.agentName" list="agentSelect"></b-form-input>
                            </b-form-group>
                            <b-form-group label="Trucking:">
                                <b-form-input v-model="customerForm.truckingName" list="truckingSelect"></b-form-input>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                            <b-form-input v-model="customerForm.table" value="Customer" style="display:none;"/>
                            <b-form-input v-model="customerForm.id" style="display:none;"/>
                            <b-form-input v-model="customerForm.revision" style="display:none;"/>
                        </b-form>
                    </b-modal>
                    <b-table  ref="customerTable" bordered striped hover sticky-header="600px" :items="customerList" :fields="customerFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, customerForm, 'bv-modal-customer')" class="mr-1">
                                Edit
                            </b-button>
                            <b-button size="sm" @click="info(row.item, row.index, $event.target)" class="mr-1">
                                Info modal
                            </b-button>
                            <b-button size="sm" @click="row.toggleDetails">
                                {{ row.detailsShowing ? 'Hide' : 'Show' }} Order Stats
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(address)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(telephone)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(contact)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(terms)="data">
                            {{ data.value }}
                        </template>
                        <template #row-details="row">
                            <b-card>
                                <div v-for="(value, name, index) in row.item.orderStats">
                                    {{ name }}: {{ value.count }} orders, Total Amount => {{ value.total }}, Receipts: {{ value.receiptNos }}
                                </div>
                            </b-card>
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Product">
                    <b-button @click="newFormGeneric(productForm, defaultProductValues, 'bv-modal-product')">New</b-button>
                    <b-button @click="refresh('productTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-product" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, productForm, 'bv-modal-product', 'productTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="productForm.name"/>
                            </b-form-group>
                            <b-form-group label="Category:">
                                <b-form-input v-model="productForm.categoryName" list="categorySelect"></b-form-input>
                            </b-form-group>
                            <b-form-group label="Price:">
                                <b-form-input v-model="productForm.price"/>
                            </b-form-group>
                            <b-form-group label="Default Discount:">
                                <b-form-input v-model="productForm.defaultDiscount"/>
                            </b-form-group>
                            <b-form-group label="Display Ordering (ex. a1,a2,b1,b2):">
                                <b-form-input v-model="productForm.displayOrdering"/>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="productTable" bordered striped hover sticky-header="600px" :items="productList" :fields="productFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, productForm, 'bv-modal-product')" class="mr-1">
                                Edit
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(price)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(defaultDiscount)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Agent">
                    <b-button @click="newFormGeneric(agentForm, defaultAgentValues, 'bv-modal-agent')">New</b-button>
                    <b-button @click="refresh('agentTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-agent" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, agentForm, 'bv-modal-agent', 'agentTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="agentForm.name"/>
                            </b-form-group>
                            <b-form-group label="Address:">
                                <b-form-input v-model="agentForm.address"/>
                            </b-form-group>
                            <b-form-group label="Telephone:">
                                <b-form-input v-model="agentForm.telephone"/>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="agentTable" bordered striped hover sticky-header="600px" :items="agentList" :fields="agentFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, agentForm, 'bv-modal-agent')" class="mr-1">
                                Edit
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Trucking">
                    <b-button @click="newFormGeneric(truckingForm, defaultTruckingValues, 'bv-modal-trucking')">New</b-button>
                    <b-button @click="refresh('truckingTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-trucking" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, truckingForm, 'bv-modal-trucking', 'truckingTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="truckingForm.name"/>
                            </b-form-group>
                            <b-form-group label="Address:">
                                <b-form-input v-model="truckingForm.address"/>
                            </b-form-group>
                            <b-form-group label="Telephone:">
                                <b-form-input v-model="truckingForm.telephone"/>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="truckingTable" bordered striped hover sticky-header="600px" :items="truckingList" :fields="truckingFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, truckingForm, 'bv-modal-trucking')" class="mr-1">
                                Edit
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Category">
                    <b-button @click="newFormGeneric(categoryForm, defaultCategoryValues, 'bv-modal-category')">New</b-button>
                    <b-button @click="refresh('categoryTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-category" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, categoryForm, 'bv-modal-category', 'categoryTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="categoryForm.name"/>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="categoryTable" bordered striped hover sticky-header="600px" :items="categoryList" :fields="categoryFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, categoryForm, 'bv-modal-category')" class="mr-1">
                                Edit
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Counter">
                    <b-button @click="newFormGeneric(counterForm, defaultCounterValues, 'bv-modal-counter')">New</b-button>
                    <b-button @click="refresh('counterTable')">Refresh Table</b-button>
                    <b-modal ref="bv-modal-counter" hide-footer>
                        <b-alert variant="danger" :show="showErrorAlert">{{ errorMessage }}</b-alert>
                        <b-alert variant="danger" :show="showErrorDetail">
                            <div>System Error</div>
                            <b-button :pressed.sync="showStackTrace" variant="primary">
                                {{ showStackTrace ? 'Hide' : 'Show' }} Error Details
                            </b-button>
                            <b-card v-if="showStackTrace">
                                {{ errorDetailMessage }}
                            </b-card>
                        </b-alert>
                        <b-form @submit="onSubmit($event, counterForm, 'bv-modal-counter', 'counterTable')">
                            <b-form-group label="Name:">
                                <b-form-input v-model="counterForm.name"/>
                            </b-form-group>
                            <b-form-group label="Current Value:">
                                <b-form-input v-model="counterForm.value"/>
                            </b-form-group>
                            <b-button type="submit" variant="primary">Submit</b-button>
                        </b-form>
                    </b-modal>
                    <b-table  ref="counterTable" bordered striped hover sticky-header="600px" :items="counterList" :fields="counterFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b>{{ row.index + 1 }}</b>
                            <b-button size="sm" @click="edit(row.item, counterForm, 'bv-modal-counter')" class="mr-1">
                                Edit
                            </b-button>
                        </template>
                        <template #cell(name)="data">
                            {{ data.value }}
                        </template>
                        <template #cell(value)="data">
                            {{ data.value }}
                        </template>
                    </b-table>
                </b-tab>
                <b-tab title="Monthly Sales Report">
                    <b-button @click="refresh('monthlySalesTable')">Refresh Table</b-button>
                    <b-table  ref="monthlySalesTable" bordered striped hover sticky-header="600px" :items="monthlySalesList" :fields="monthlySalesFields"
                              :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                        <template #table-busy>
                            <div class="text-center text-danger my-2">
                                <b-spinner class="align-middle"></b-spinner>
                                <strong>Loading...</strong>
                            </div>
                        </template>
                        <template #cell(edit)="row">
                            <b-button size="sm" @click="info(row.item, row.index, $event.target)" class="mr-1">
                                Info modal
                            </b-button>
                            <b-button size="sm" @click="row.toggleDetails">
                                {{ row.detailsShowing ? 'Hide' : 'Show' }} Product Quantity Breakdown
                            </b-button>
                        </template>
                        <template #row-details="row">
                            <b-card>
                                <b-table  ref="monthlySalesTable" bordered striped hover sticky-header="600px" :items="row.item.orderedProductSales" :fields="monthlySalesProductListFields"
                                          :busy="isBusy" @row-dblclicked="edit" :tbody-transition-props="transProps">
                                </b-table>
                            </b-card>
                        </template>
                    </b-table>
                </b-tab>
            </b-tabs>

    </div>

    <!-- Add Vue and Bootstrap-Vue JS just before the closing </body> tag -->
    <script src="https://unpkg.com/vue/dist/vue.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
    var app = new Vue({
      el: '#app',
      data: {
        isBusy: false,
        transProps: {
          name: 'flip-list'
        },
        dismissSecs: 5,
        dismissCountDown: 0,
        showErrorAlert: false,
        showStackTrace: false,
        errorMessage: '',
        showErrorDetail: false,
        errorDetailMessage: '',
        selectedItem: {},
        allItems: [],
        customerDataList: [],
        productDataList: [],
        agentDataList: [],
        truckingDataList: [],
        categoryDataList: [],
        infoModal: {
          id: 'info-modal',
          title: '',
          content: ''
        },
        defaultCustomerValues: {
          name: '',
          address: '',
          telephone: '',
          contact: '',
          terms: '60',
          agentName: '',
          truckingName: '',
        },
        customerForm: {
          name: '',
          address: '',
          telephone: '',
          contact: '',
          terms: '',
          agentName: '',
          truckingName: '',
          table: 'Customer',
          id: '',
          revision: ''
        },
        defaultProductValues: {
          name: '',
          price: '',
          categoryName: '',
          displayOrdering: '',
          defaultDiscount: 'NET',
        },
        productForm: {
          name: '',
          price: '',
          categoryName: '',
          displayOrdering: '',
          defaultDiscount: '',
          table: 'Product',
          id: '',
          revision: ''
        },
        defaultCounterValues: {
          name: '',
          value: ''
        },
        counterForm: {
          name: '',
          value: '',
          table: 'Counter',
          id: '',
          revision: ''
        },
        defaultCategoryValues: {
          name: ''
        },
        categoryForm: {
          name: '',
          table: 'Category',
          id: '',
          revision: ''
        },
        defaultPaymentValues: {
          type: 'check',
          receiptNoList: '',
          checkNo: '',
          bank: '',
          value: '',
          clearingDate: '',
          bouncedDate: ''
        },
        paymentForm: {
          type: '',
          receiptNoList: '',
          checkNo: '',
          bank: '',
          value: '',
          clearingDate: '',
          bouncedDate: '',
          table: 'Payment',
          id: '',
          revision: ''
        },
        defaultAgentValues: {
          name: '',
          address: '',
          telephone: ''
        },
        agentForm: {
          name: '',
          address: '',
          telephone: '',
          table: 'Agent',
          id: '',
          revision: ''
        },
        defaultTruckingValues: {
          name: '',
          address: '',
          telephone: ''
        },
        truckingForm: {
          name: '',
          address: '',
          telephone: '',
          table: 'Trucking',
          id: '',
          revision: ''
        },
        defaultOrderValues: {
          customerName: '',
          deliveredDate: '',
          canceledDate: ''
        },
        orderForm: {
          customerName: '',
          deliveredDate: '',
          canceledDate: '',
          table: 'Order',
          id: '',
          revision: ''
        },
        defaultOrderDetailValues: {
          productName: '',
          quantity: '',
          isPromo: 'false'
        },
        orderDetailForm: {
          productName: '',
          quantity: '',
          isPromo: '',
          table: 'Order',
          method: 'addProductRecord',
          id: '',
          revision: ''
        },
        searchForm: {
            Order: {
                viewId: 'Order/byLastEdited',
                includeKey: false,
                key: '',
                receiptNo: '',
                customer: ''
            },
            Customer: {
                viewId: '_all_docs',
                includeKey: false,
                key: '',
                customer: ''
            }
        },
        customerFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'address'
          },
          {
            key: 'contact',
            label: 'Contact Person'
          },
          {
            key: 'telephone',
            label: 'Tel Number'
          },
          {
            key: 'agentName'
          },
          {
            key: 'truckingName'
          },
          {
            key: 'terms'
          }
        ],
        productFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'price'
          },
          {
            key: 'defaultDiscount'
          }
        ],
        counterFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'value'
          }
        ],
        categoryFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          }
        ],
        paymentFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'paymentNo'
          },
          {
            key: 'customerName'
          },
          {
            key: 'receiptNoList'
          },
          {
            key: 'clearingDate'
          },
          {
            key: 'bouncedDate'
          },
          {
            key: 'type'
          },
          {
            key: 'checkNo'
          },
          {
            key: 'bank'
          },
          {
            key: 'value'
          }
        ],
        agentFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'address'
          },
          {
            key: 'telephone',
            label: 'Tel Number'
          }
        ],
        truckingFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'address'
          },
          {
            key: 'telephone',
            label: 'Tel Number'
          }
        ],
        monthlySalesFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'yearMonth',
            sortable: true
          },
          {
            key: 'totalOrder'
          },
          {
            key: 'totalValue',
          }
        ],
        monthlySalesProductListFields: [{
            key: 'name'
          },
          {
            key: 'quantity',
          }
        ],
        orderFields: [{
            key: 'edit',
            label: 'Action'
          },
          {
            key: 'receiptNo'
          },
          {
            key: 'customerName'
          },
          {
            key: 'deliveredDateString'
          },
          {
            key: 'total'
          },
          {
            key: 'collectionDateString'
          },
          {
            key: 'totalPayments'
          },
          {
            key: 'paidDateString'
          },
          {
            key: 'daysFromDeliveredToPaid'
          },
          {
            key: 'canceledDateString'
          }
        ],
        orderDetailProductFields: [
          {
            key: 'quantity',
          },
          {
            key: 'name',
            sortable: true
          },
          {
            key: 'price'
          },
          {
            key: 'discount'
          },
          {
            key: 'total'
          }
        ],
        orderDetailPromoFields: [
          {
            key: 'quantity',
          },
          {
            key: 'name',
            sortable: true
          }
        ],
        orderDetailPaymentFields: [
          {
            key: 'paymentNo',
          },
          {
            key: 'value'
          }
        ]
      },
      methods: {
        countDownChanged(dismissCountDown) {
          this.dismissCountDown = dismissCountDown;
        },
        showSuccessMessage() {
          this.dismissCountDown = this.dismissSecs;
        },
        refresh(refId) {
          this.$refs[refId].refresh();
        },
        resetError() {
          this.showErrorAlert = false;
          this.showErrorDetail = false;
          this.showStackTrace = false;
        },
        newFormGeneric(form, defaultValues, refId) {
          Object.assign(form, defaultValues);
          console.log("Form:");
          console.log(form);
          console.log("Default:");
          console.log(defaultValues);
          form.id = '';
          form.revision = '';
          console.log("REF_ID:" + refId);
          this.resetError();
          this.$refs[refId].show();
        },
        edit(item, editForm, refId) {
          this.selectedItem = item;
          Object.keys(editForm).forEach((key) => {
            if (key != 'table') {
              editForm[key] = item[key];
            }
          });
          console.log(editForm);
          this.resetError();
          this.$refs[refId].show();
        },
        getData(ctx, callback, type) {
          this.isBusy = true;
          var searchForm = this.searchForm[type];
          var viewId = '_all_docs';
          var key = '';
          if(searchForm){
            viewId = searchForm.viewId;
            if(searchForm.includeKey){
                key = searchForm.key;
            }
          }
          var url = '/list?table=' + type + '&viewId='+viewId+ '&key='+key;
          console.log("Loading getData..."+ url);
          axios.get(url)
            .then((response) => {
              this.isBusy = false;
              console.log(response);
              this.allItems = response.data;
              callback(response.data);
            })
            .catch((error) => {
              this.isBusy = false;
              console.log(error);
              callback([]);
            });
        },
        convertToMap(data){
            var map = new Map();
            data.forEach(function (item) {
                if(item.name){
                    map.set(item.name, item.id);
                }
            });
            return map;
        },
        getDataSelect(type) {
          console.log("Loading Select..."+ type );
          axios.get('/list?table=' + type + '&viewId=_all_docs')
            .then((response) => {
              if(type == 'Customer'){
                this.customerDataList = this.convertToMap(response.data);
                console.log(this.customerDataList);
              }
              else if(type == 'Product'){
                this.productDataList = this.convertToMap(response.data);
                console.log(this.productDataList);
              }
              else if(type == 'Agent'){
                this.agentDataList = this.convertToMap(response.data);
                console.log(this.agentDataList);
              }
              else if(type == 'Trucking'){
                this.truckingDataList = this.convertToMap(response.data);
                console.log(this.truckingDataList);
              }
              else if(type == 'Category'){
                this.categoryDataList = this.convertToMap(response.data);
                console.log(this.categoryDataList);
              }
            })
            .catch((error) => {
              console.log(error);
            });
        },
        customerList(ctx, callback) {
          this.getData(ctx, callback, 'Customer');
        },
        productList(ctx, callback) {
          this.getData(ctx, callback, 'Product');
        },
        counterList(ctx, callback) {
          this.getData(ctx, callback, 'Counter');
        },
        categoryList(ctx, callback) {
          this.getData(ctx, callback, 'Category');
        },
        paymentList(ctx, callback) {
          this.getData(ctx, callback, 'Payment');
        },
        agentList(ctx, callback) {
          this.getData(ctx, callback, 'Agent');
        },
        truckingList(ctx, callback) {
          this.getData(ctx, callback, 'Trucking');
        },
        monthlySalesList(ctx, callback) {
          this.getData(ctx, callback, 'MonthlySales');
        },
        orderList(ctx, callback) {
          this.getData(ctx, callback, 'Order');
        },
        filterReceiptNo(){
            this.searchForm['Order'].viewId = 'Order/byReceiptNo';
            this.searchForm['Order'].includeKey = true;
            this.searchForm['Order'].key = this.searchForm['Order'].receiptNo
            this.refresh('orderTable');
        },
        filterCustomerOrder(){
            this.searchForm['Order'].viewId = 'Order/byCustomerId';
            this.searchForm['Order'].includeKey = true;
            var customerName = this.searchForm['Order'].customer;
            this.searchForm['Order'].key = this.customerDataList.get(customerName);
            this.refresh('orderTable');
        },
        showPendingOrder(){
            this.searchForm['Order'].viewId = 'Order/byPendingOrder';
            this.searchForm['Order'].includeKey = false;
            this.refresh('orderTable');
        },
        showDueOrder(){
            this.searchForm['Order'].viewId = 'Order/byDueOrder';
            this.searchForm['Order'].includeKey = false;
            this.refresh('orderTable');
        },
        showLastEditedOrder(){
            this.searchForm['Order'].viewId = 'Order/byLastEdited';
            this.searchForm['Order'].includeKey = false;
            this.refresh('orderTable');
        },
        filterCustomerName(){
            this.searchForm['Customer'].viewId = 'Customer/byName';
            this.searchForm['Customer'].includeKey = true;
            var customerName = this.searchForm['Customer'].customer;
            this.searchForm['Customer'].key = customerName;
            this.refresh('customerTable');
        },
        showUncollected(){
            this.searchForm['Customer'].viewId = 'Customer/byUncollected';
            this.searchForm['Customer'].includeKey = false;
            this.refresh('customerTable');
        },
        showPaying(){
            this.searchForm['Customer'].viewId = 'Customer/byPaying';
            this.searchForm['Customer'].includeKey = false;
            this.refresh('customerTable');
        },
        info(item, index, button) {
            this.infoModal.title = `Row index: ${index}`
            this.infoModal.content = JSON.stringify(item, null, 2)
            this.$root.$emit('bv::show::modal', this.infoModal.id, button)
        },
        download(id) {
          window.location = '/generateXLS?id=' + id
        },
        resetInfoModal() {
            this.infoModal.title = ''
            this.infoModal.content = ''
        },
        onReletedSubmit(event, submitForm, item) {
          event.preventDefault();
          this.selectedItem = item;
          submitForm.id = item.id;
          submitForm.revision = item.revision;
          this.onSubmit(event, submitForm, null);
        },
        onSubmit(event, submitForm, refId, tableId) {
          event.preventDefault();
          console.log('Submit');
          console.log(submitForm);
          var id = submitForm.id;
          axios.post(
              "/saveToDb",
              submitForm
            )
            .then(response => {
              console.log(response);
              console.log(response.data.error);
              console.log(response.data.stackTrace);
              var error = response.data.error;
              if (error.length > 0) {
                console.log('show error message');
                this.resetError();
                this.showErrorAlert = true;
                this.errorMessage = error.toString();
                if (response.data.revisionError) {
                  console.log('revision Error');
                  const {
                    attachments,
                    narrative,
                    ...copyForm
                  } = response.data.result;
                  Object.assign(this.customerForm, copyForm);
                }
              } else {
                var stackTrace = response.data.stackTrace;
                if (!stackTrace || stackTrace.length == 0) {
                  if(refId){
                    this.$refs[refId].hide();
                  }
                  console.log("ID:" + id);
                  if (!id || id.length == 0) {
                    console.log('push to table');
                    this.refresh(tableId);
                  } else {
                    console.log('write to vue table');
                    Object.assign(this.selectedItem, response.data.result);
                  }
                  this.showSuccessMessage();
                } else {
                  console.log('show stacktrace');
                  this.resetError();
                  this.showErrorDetail = true;
                  this.errorDetailMessage = stackTrace;
                }
              }
            })
            .catch(error => {
              console.log(error);
              this.resetError();
              this.showErrorAlert = true;
              this.errorMessage = 'Connection Error';
            });
        }
      },
      created(){
        this.getDataSelect('Customer');
        this.getDataSelect('Product');
        this.getDataSelect('Agent');
        this.getDataSelect('Trucking');
        this.getDataSelect('Category');
      }
    });
    </script>
</body>
</html>